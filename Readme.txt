2020.7.8 1515
1.从0520版本COPY来的。
2.用于建立Sourceinsight和后续的修改验证等工作
2020.9.3 1533
1.上升下降双沿捕获时间，进入中断已经成功。
2.设计在上升沿后进行进行协议处理
3.协议通讯未成功。调试中
2020.09.03 1642
1.PLIP 通讯基本成功。
2.版本保存
2020.09.10 1337
1.PLIP调试发现BUG，PTM 只有10位，最大定时1024us。所以修改我们的PTM时钟分频至1/4M。
2.FLASH 芯片的电平时5V，仿真芯片的电平时3V，所以翻转电平和拉码电流都是根据5V进行重新设定。
3.时钟校准的问题，E-WRITE Pro 要校准时钟。需要在工程的芯片处选择芯片电压和设定的工作主频，进行时钟校准。
2020.09.10 1922
1.比较电平修改到17V。因为回路卡输出22.5V。然后全桥电路也有压降，所有20V翻转电压可能比较便捷。
2.拉码修改为阶段性的拉码和结束，以消除大负载。
目前配置为step3 和Delay1。经过测试稳定态100us，上升下降沿各50us。delay1 是必须的，否则无法实现step3拉码的阶梯效果。
2020.09.11 1424
1.修改了初始化 ，增加了PLT的 比较器校准和 运放校准功能。
2.经测试，不影响实际通讯
2020.09.11 2024
1.增加了 动态调整 比较电平的功能。在第一个INTB 实现的。
2.突然调整 比较器DAC，造成进入两次中断的情况。
3.协议栈估计还是有BUG，首次通讯时，还有刷新状态，偶有发生错误的情况。
2020.09.14 1558
1.动态调整阈值的下限修改为9V,基本不限制。
2020.09.14 1632
1.开启了低功耗，在只保留通讯的情况下，没有感烟功能的时候，静态功耗33uA;通讯时的max功耗 449uA; 4秒通讯一次，平均功耗56uA.
2.这个版本，通讯开始后一直保持在高功耗，没有实现通讯中低功耗的功能.
3.另，上电时刻的比较电平调整功能，导致通讯失败，原因待查。
2020.09.15 1415
1.程序调整为 上电后2秒进行1次比较电平调整。在没有通讯的时候4秒采集一次总线电压，调整一下比较电平。
2.拉码还是50mA.调整为25mA后 出现和回路卡通讯不良的情况。原因待查明。
3.到MCU的极限电压12.59V。
4.带声光重负载的时候，在2k米时，还是出现了不到15V低电平，通讯不良的情况。没有通讯能达到12.59V的
2020.09.16 1645
1.屏蔽了比较电平的上下限。拉码电压修改到5V了。2km长线，11.2V电源电压，芯片引脚电压6.74V，比较电平DAC 4，4.68V
2.5V芯片，拉码缓慢升高和降低经过实测约200us，回路卡解码下来大约160us。
2020.09.17 1738
1.在下降沿中断比较电平，增加了迟滞作用。配置为150mV,算上外围的电阻15倍，比较电平支持150*15mV.
2.上电增加了两段式电平匹配。
3.采集线电压时，增加了4采样，去极值取平均。
2020.09.18.1441
1.增加逻辑，通讯比较捕获中断，首次进入的时候，由于高电平尚未发生，高电平时长是不确定的。
  此时，不判断脉宽长度。
2.增加逻辑，在通讯中调整了比较电压后，4sec内不再测量总线电压。
3.在声光协同时，电线电压剧烈波动，还是导致比较电平跟随来不及。

2020.09.18 1712
1.为了应对声光同步的时刻，总线电压波动特别剧烈，
帧和帧之间的电压波动超过5V了。导致第二帧应用前一个帧的比较电平时，进入不了通讯。
2.所以设计了一个70ms 不停进行调节的功能。
70ms中运行412us，功耗增加了 10几个uA

2020.09.22 1428
1.增加了在通讯中，空闲了进入 空闲模式1：因为要保持高速时钟运行给PTM计数。
2.Bastime0 生产1秒钟定时。
3.功耗略有降低；62.5ms仍然在满载，声光协同时偶发丢帧。

2020.09.22 1731
1.增加了红蓝光的采样配置了。
2.临时修改为1秒采样一次。耦合方式是ac方式
2020.09.24 1651
1.根据例程，修改了部分代码的结构，逻辑不影响。
2.采样不稳定的原因首先是没有金属遮光板的原因。其他还有小的影响因素。
3.需要增加逻辑，在感烟采样的时候，不进行回路电平比较电压的调整，尚未完成。
4.连续监视过程中，出现过通讯丢帧的情况，需要关注。
2020.9.25 1706
1.增加了7:3滤波；尝试了4次采样去极值平均，效果不好。

2020.10.26 1328
1.临时版本，增加了10个byte的buff 用于临时记录AC耦合下的测量值。
2.烟感的运放校准，暂时关闭，使用了固定值。
  上电后，需要等待电源稳定，在没有通讯的状态下，进行校准.
3.这个版本发现AC耦合下测量的烟感AD值非常不稳定，具体原因不确认是软件还是硬件问题。
2020.10.29 1423
1.这个版本程序比较乱。在之前的版本发现，全桥电流更换为小的二极管，下降沿延迟增大后，出现通讯不稳定的现象。
同时还发现，在FUNC.H中多定义10个字节的不用变量，都会导致通讯不稳定的现象。
2.经过连续3天的调查和研究，基本结论有了：
  一、硬件更换的小的二极管，下降延迟增大了。从下降沿到单片机进入中断耗时35us~40us.原来的大的二极管，下降速度快一些，不会触发通讯的问题。
    通讯的问题是：全桥延迟40us后，程序处理大约20个us，这样低电平的60us就处于极限的状态，将上升沿中断错过了。
  二、为什么多定义10个字节的不用变量就造成了通讯不稳定的问题。是因为这个单片机的RAM 分为128个字节2个Bank。其中bank0是直接寻址，bank1是间接寻址。编译器在分配变量存储的时候是不一定得。bank1的6个寄存器访问就慢了7条指令。一条指令执行需要4个clk，4M主频的时候，就是延迟7us。ISR中的临时变量没有专门的栈区，也是保存在同一块空间的RAM中的，这样ISR的临时变量存储在BANK0还是BANK1就不确定，就带来了7us的不确定性。
而硬件处于一个边界的状态就出现这样的问题。
3.针对上面的问题，对通讯的处理修改为只记录下降沿中断，上升沿不关注。程序代码做了配置的修改，没
有修改注释。ISR中的脉宽判断也没有对应调整。初测解决了上述问题。

2020.10.29 1644
1.版本更新为0102版本。在上一个版本的基础上，整理了代码。
2.起始的两段式比较电平，高电平的比较电平调整到17V。
在24V供电的时候，全桥后的电平最低只能下降到15V。
3.脉宽只记录下降沿的宽度。宽度阈值也加上了60us的低
电平的时间

2020.10.30 1711
1.增加了上电3秒后，进行AFE的AMP的校准。
  AMP校准后，恢复AFE的相关设置。
  AMP校准运行约10ms
2.配置AC耦合模式下，稳定性可以

2020.11.2 1711
1.发现了在二级放大倍数调小的情况下，直流的配置情况1.5M电阻，放大倍数31倍时，值飘动变小。
但是同时，发现的采样值在反复横跳，约10个AD值。
  经过排查发现PTM的中断在没有通讯的时候，仍然在运行，这样就导致260ms一次的溢出中断和260ms周期过程中一次2ms的P匹配中断。
  而这ISR可能在原程序的采样过程中出现。
2.针对这情况，将PTM的进入P中断后，即2ms断帧的ISR后，就停止计数器。然后进入捕获中断后再开启计数器。
  这样就在没有通讯的时候，不再进入P中断和PTM的周期溢出中断。
  问题也会有，就是计数值少了进入ISR的过程中的10个us的计数，1/4M主频时，约为3个计数值。在通讯允许的范围内。
3.本版本经过测试，在AC和DC配置AFE的情况下，都没有发现横跳的问题

2020.11.04 1410
1.删除一些重复的宏定义。
2.整理代码。

2020.11.05 1650
1.增加了一些5541的宏定义内容。
2.通讯的协议栈处理放到接收<99的判断内。
3.经测试通讯正常

2020.11.05.2100
1.模块的电压是3.3V。
2.暂时是能通讯的。但是发现的问题
  自动校准不对。
  低功耗后，750ms反复进P中断。
  目前是全功耗的。
  LED和声音还没有做
2020.11.07 1632
1.版本升级到V0104。
2.AV通讯稳定版本。
  AV的工程配置修改为3.3v.5541只有3V版本的单片机
  5541的AD的通道和5542不一样。
  PTM的配置也有一点区别。
  ISR的中断向量表也不太一样。都进行了修改。
  C0023批次前的5541芯片存在0.05%的概率PTM在捕获的时候计数失败，错误的记成0.
3.点灯和声音部分尚未调试

2020.11.11 1829
1.将62.5ms进行一次的比较电平调整放到了主循环中，
以解决 ISR中不能调用和主循环中的同名子函数问题。
2.在自动调整比较电平的逻辑中增加了，如果在采样过程中发生了通讯，则不更新调整值的逻辑。
  经过点灯实测和记录调整的max和min，实测没有影响
  这个逻辑和大循环中的判断不在通讯中再自动调整并不冲突。那个大循环的判断，可以在尽快结束主循环，进入休眠

2020.11.13 1636
1.整合了原来的一个AV程序。
  Sound口调整到PC0
2.删除了测试代码。增加了在PLT动态调整过程中，如果发生了通讯中断，将不进行调整的逻辑。
  实测确实有效，不会出现第一个低脉宽的过程中采样的事情。
3.版本调整到V0105

2020.11.19 1754
1.版本升级至V0106
2.AV的程序实现了按照最大4组进行分组，并根据分组调整声响的时长。
3.实现了通过 通讯同步帧进行各AV的分组同步。
4.为了实现同步，使用CTM1，定时30ms（即使选用32.869K 最大也只能定制32ms）作为唤醒tick.
5.不用base0改用ctm1是因为base0无法清零cnt，同步帧后无法清零唤醒tick的CNT，则无法实现闪灯的同步

2020.11.20 1732
1.修改了PWM Sound的周期和占空比。周期现在是350us，高电平120us.
2.AV的拉码电阻硬件修改到了12Ω。同步调整了程序的DA拉码到6；
3.拉码时间宽度同步调整了。190us实测。
2020.11.23 1634
1.增加了连续响3次，然后空闲2个周期，空闲周期中只闪灯的功能。
2.增加了调试用的代码，可以在EE的0x3E位置 修改声音的周期*10us，0x3F的位置修改高电平的时间长度*10us.
3.修改BUG，写EE的判断长度63，修改为64，否则0x3F的位置的写操作无法完成
2020.11.24 1800
1.版本升级到V0107
2.编写地址不能超过16的BUG 找到了。是device的对帧的校验部分处理不对，多分了高低位。
3.闪光的时间从60ms调整到30ms
2020.11.25 1448
1.为声音增加了首3次的渐强音。通过改变占空比实现的。从第4次响声开始，都是保持120usHighvol/350usCycleTime 
2.但是即使1usHighVol，都会超过45db。

2020.11.26 1024
1.版本升级V0108
2.渐强音升级为占空比和周期都能调整。

2020.12.02 1533
1.将PltOpaSwitchOn()和PltOpaSwitchOFF()的GCC_DELAY  修改为NOP。以避免和中断中的拉码的GCC_DELAY同名。
2.修复BUG，PLT的OPA开启后需要稳定40us，否则在拉码时会出现一个电流。通过提前一个CLK打开OPA的方式，提前打开OPA。
3.还有一个可能的芯片一致性问题：一批硬件中，有的板子在第一个拉码开始前，切换PLTS0时，出现一个大的5us以下，有的甚至在1us以下的电流尖峰。
有的板子正常。如果PLT没有从测量线电压，转换为拉码，则不会出现这个电流尖脉冲。

2020.12.03 1429
1.为了探究到通讯和比较阈值的电平极限
  修改了PLT的驱动电流和比较器的迟滞窗口至比较器驱动电流设置为01，迟滞宽度0.9Vmax。
  比较器驱动电流设置为 01.  2.5us相应14~22uA电流消耗
2.比较阈值最小修改为8:6.12V。code7:5.4V 太极限了。
  VCOM+ 7V是极限的情况了。

2020.12.22 1555
1.增加了AV通讯在总线电压低于11V后，限制使用CODE8的比较阈值。
原因是在长线1.1KM后，满回路的情况下，电源波动正好造成了比较阈值偏大的问题。
修改后，实测有明显改善，AV 4分组 可以达到1.7KM

2020.12.23 1726
1.增加总线电压连续600ms <3V 就自动复位的功能
2.AFE的初始化修改。为了支持在感烟采样过程中可以切换放大倍数。
  目前蓝光还是一样的放大倍数，但是接口已经做好了。
  实测表现和一个AFE放大倍数表现一致。

2020.12.24 1604
1.修改AFE的接口，增加R2SET。
2.红外放大倍数修改为：500K  30K和2400K。DC 模式

2020.12.31 1445
1.为感烟添加了一个初步的报警程序，未经充分验证

2021.01.05 1714
1.版本升级到V0109
2.感烟算法添加了烟室故障，灰尘报警修改为如果当前值达到240-Dark 进行判断
如果4个值当中有两2、3、4个值变化超过75.则认为是灰尘。
3.蓝光/红光在红光20~120之间才修改报警阈值。避免了烟箱的比值逐渐下降的问题。
4.经过3把真火，1个小烟箱，1个灰尘的数据仿真测试可能正常报警。

2021.01.06 1317
1.增加了临时的监视运行状态的变量和位定义。
2.实际待测试。
2021.01.13 1432
1.添加了部分的usart调试的代码，尚未测试。
2.AFE 配置为500K 30K 1.6M 。OPA0 延时2ms OPA1延时2ms. 
DC模式，点灯200us


2021.01.14 2045
1.AFE修改到1.5M 10K 200K的配置
2.感烟算法增加了 检测到升烟拐点 计算后续90sec的平均值 用于判断是否是正庚烷火
  目的是除了正庚烷的火用0.11db的阈值，其他真火也使用0.4db的阈值


//////////////////////////////////////////////////////////////////
2021.01.20 1730
1.版本升级到0x010A
2.程序框架修改。代码分为smoke（5542）和module (5541)
  将AV作为模块的一种模块。模块一种代码，然后通过EE进行选择
3.编译无问题，未进行验证

2021.01.21 1840
1.增加了MCP和HDY的代码。编译无错误，未测试

2021.01.22 1614
1.发现ADC在采集MCP的输入时，输入电阻270K，导致AD采集值偏小，而且跳动。
  后针对模块，将ADC的clk降低到fsys/16。稳定也能基本达到电压了。
2.MCP，消火栓和接口模块，基本测试验证了下代码。
	接口模块没有带传统型探测器测试，电阻测试了
3.当前点灯，除了接口模块的短路有自主点灯。其他全部都是被动点灯。
2021.01.26 1400
1.发现通讯的组查询BUG。当设置为组查询0x0F查询命令时，应该使用组号来进行回码，而源代码仍然使用组内index回码
2.已修复验证

2021.01.27 1811
1.增加了IO和脉冲IO的代码。未测试
2021.01.28 1759
1.添加了ISO的代码。未测试。
2021.01.29 1435
1.添加了感温的代码。因为感温代码的大小问题，单独一个目标文件。未测试
2021.01.29 1508
1.分割为module 和 heat 和 smoke 三个工程文件。
2.未测试
3.空间已经到:
Heat   flash84%;ram95%

smoke  flash72%;ram83%

module flash90%;ram71%

2021.2.24 0933
1.新增输入输出模块、脉冲型输入输出模块、ISO的程序代码。
2.初步测试输入输出和ISO功能基本正常。脉冲型功能有待商榷。

2021.2.25 2153
1.增加输入输出模块的双地址策略。代码添加完毕，编译成功。
未调试。
2021.2.27 1116
1.初步调试了IO模块的双地址策略。双地址事件等详细逻辑尚未调试
2.广播地址只有主地址应答。

2021.2.28 1834
1.程序依据 0226版本的V0.05版暂定的PLIP协议作出了相应的修改。主要是state 和out寄存器
EE未修改。
2.因为程序代码空间的问题，ISO的代码需要单独编译一个版本。
3.编译无错误，未详细测试

2021.3.10 1739
1.根据新版协议，修改了EE和寄存器。代码完成，编译无问题，没有测试。

2021.3.11 1605
1.增加产品类型脉冲型输出51;
2.state寄存器的变化才能引发事件；exstate的变化不会触发事件；
3.AV的extstate的lightON和Sound分开
4.脉冲型输出 增加充电命令0xC1和0xC2
5.按照新的EE来设置。
6.FACSET的双地址功能设置修改为0x02

2021.3.11 1744
1.由于程序空间的原因，将程序进行分割。
  AV一个程序；脉冲输出一个程序；ISO一个程序。
2.双地址的state寄存器的BUG 修复。

2021.3.12 1821
1.增加了IN，Out模块功能。
2.修改了out的检测输出开路和短路的判断条件。ctrlset上电是0，不能判断0xD2
2021.3.14 1637
1.默认处于非monitor状态。
2.重写了脉冲型IO的功能。暂定为：输出时不进行输出通路检测；电容充电和输出互斥
输出通路短路也能够进行充电。

2021.3.16 1818
1.版本升级到V010B
2.MCP和消火栓增加输入就自主点灯的命令。
3.增加了回路电压监视功能。
4.重新整理了命令帧
5.重新整理了ZONE组播和TYPEID 组播命令。
6.规划了0x10~0x19的寄存器用于输出调试信息；4,5,6,7空闲命令和暂借用3号命令用于双字节输出
7.EE的ADDR1，2做了复用的操作。并增加了 回路电压监视功能可配置

2021.3.17 1826
1.interface模块由于增加了控制24V输出通道打开或者关闭，导致和input不能共用代码。
2.进行了拆分，待测试。影响输入相关和接口模块

2021.3.18 1409
1.MCP和消火栓，接口模块的 enable命令不再点灯。
2.按类型组播的时候TypeId 如果是输出模块，则输入输出模块也同样输出
如果是脉冲型输出模块，则输入输出脉冲型也同样输出

2021.3.19 1524
1.事件查询闪灯命令，增加了闪灯根据分组进行延时的功能。
  闪灯8ms，间隔2ms.
2.经测试效果可以。

2021.03.28.1723
1.感烟修改为先点亮蓝灯，再点亮红灯。
原因是蓝灯的压降大，否则可能导致点完红灯后的电压不足以驱动蓝灯。
2.修改了AFE的放大倍数至900K 10K200K。
  原因是更换了恒润的双波段发射管。
3.修订了感温的部分，主要是IO口和AD的配置。统一算法需要12位AD。该芯片max10位。
为了适配感温算法，返回AD位数补了2位0。

2021.04.09 1835
1.添加了带AV的感烟探测器代码。
2.添加了工厂测试命令。
3.AV的分组修改到寄存器。
4.增加了ledctrl命令
5.程序空间已经超出了flash。需要屏蔽掉总线电源检测功能，才能完成。
6.带感烟的探测器的分组LED 闪烁也需要使用STM。声音也需要使用STM。

2021.4.14 1728
1.低温感烟丢帧存在。保存版本

2021.4.21.1653
1.通讯动态调整电平从80%，降低到70%。
 原因是 DAC和比较器，还有内部的分压电阻的温度特性的误差造成的。
2.通讯增加校验如果是0x00转义为0x55.原因程序已经注明。
3.感温参数，经过20日的试验再进行微调。30C/MIN调整到灵敏一些。

2021.4.23 1724
1.发现BUG，带蜂鸣器的感烟的点灯疯狂闪。
2.原因是感言部分和蜂鸣器部分的运行周期不一样。串扰了。
3.增加了AV部分的修改占空比的代码。

2021.4.30 1608
1.增加了上电的4周期灰尘检测；16周期的快速漂移补偿值确认。
2.增加了慢速16小时的漂移补偿功能。
3.感烟全部不支持回路电压监测功能；
4.带蜂鸣器的感烟，不支持漂移补偿功能。
5.删除了原先的运行中判断灰尘算法――不能和点检烟枪区分，
  仅保留运行过程中，对灰尘消失后的清标志功能。
6.增加了写EE的3点buff功能

2021.5.11  1032
1.由于RAM的Bank的影响，导致不能知道连续的大的存储空间了，所以分散定义了变量
2.增加感烟的校准，漂移补偿等功能。受限于空间，必须屏蔽掉动态电源电压监视功能。
3.感烟和蜂鸣器感烟，必须分为两个程序，才能编译下。
  蜂鸣器感烟只有上电报赃的功能，没有慢速漂移补偿的功能。
4.平时不打开蓝光。

2021.5.14 1537
1.为带蜂鸣器的感烟添加脉冲型点灯功能。
2.修改相应的IO口。
3.为实现显示效果，修改唤醒周期31.25ms。

2021.5.17 1640
1.修改了远程测试点灯命令。修改为判断状态。在comRefresh中修改状态，保证实时性。
2.这样就能同时进入远程测试和发出声音

2021.05.18 1540
1.蜂鸣器感烟提供两种频率范围。
2.IO模块的PWR检测更换为AD模式，阈值修改为10.8V。
  LED灯的IO口更换。
  在通讯中不进行 继电器刷新逻辑添加。
3.带感烟的蜂鸣器，需要独立的保持唤醒标志

2021.5.19 1802
1.蜂鸣器的感烟，修订了寄存器写入方式。待测。
2.感烟探测器修订为48秒，24次采样。拐点确定修订为15.
待测。

2021.5.20 1903
1.调整产品类型的定义。删除有源IO和脉冲IO。增加IO的输入部分，输出部分定义。
2.增加config寄存器。增加可配置是否输出的功能。
3.对应调整 TYPEID寄存器

2021.5.25 1144
1.因为程序空间问题，调整校准至8位数据。
2.增加了脉冲IO的电压采集功能等。待测。
3.增加了比值的阈值校准值。

2021.5.25 1459
1.删除了比例的校准。
2.整理的代码。脉冲IO修改为电容充电采样电路为10倍

2021.5.26 1844
1.发现芯片的一个问题，当有几mA负载时，通讯的低电平阶段，导致片内LDO调整不过来。
2.修复EE写BUG。当EE锁定时，导致无法正确抵达写成功，导致无法清buff。
3.针对问题1，蜂鸣器感烟最明显。增加了两个逻辑，发声时不采样。
通讯时不采样，同时停止声音后，LDO要5ms才能调整，增加最少保证一个周期后再采样。

2021.5.27 1539
1.针对LDO的问题，添加了蜂鸣器感烟避让发声测量，避让通讯下降沿策略。
  初步暗盒测试，很稳定。3个AD的飘动。
2.类似的方式，移植到所有的模块。
3.因无法编译进去，将HDY MCP INTF单独编译。
4.修订了脉冲IO的 电池容量的判据阈值

2021.5.28 1750
1.调试了脉冲IO的阈值和判据部分。

2021.5.31 1319
1.unmonitor和 state状态改变报事件的机制修改。
  当state没有变化时，上电后从unmonitor转换到monitor之后，不报事件。
  不再需要读state寄存器来清掉这个unmonitor造成的事件。
2. state状态变化和unmonitor 引起的事件，分离，

2021.6.4 1527
1.蜂鸣器感烟修改为直接点灯，而不是脉冲点灯。
2.MCP修改了开路、短路的逻辑。
3.Interface修订了阈值。

2021.6.8 1341
1.在EE的0x0F位置，增加了编译号。以编译查看对应的功能块是否编译进代码
2.增加了一些超时的判断。比如ADC的转换超时判据
3.增加了 组查询命令下的0xF9命令，报警组查询命令

2021.6.16 1438
1.感烟探测器增加强制开蓝光的功能。
=======================================================================
2021.6.16 1634
1.大改版本。删除了：
1. 电压异常删了

2. 声光同步删了

3. 声光分组删了

4. 声光占空比一致，功耗增加，声音不要变

5. 拉码渐变电流做成不渐变

6. 上电报脏删了

7. 漂移补偿删了
2021.06.16 1222
1.工厂命令0x55也是强制开蓝光命令。
2.删减代码版本中，也需要增加上电报脏污功能。

2021.06.25 1407
1.经过沈阳所真火摸底后，发现阈值太迟钝。
 暂定阈值修改为：正庚烷25，灵敏档61.迟钝档107
2.增加报警判断逻辑：
  如果经过比值和斜率认定当前是正庚烷，报警不再进行多次判断。
  其他类型保持不变，进行4次判断。
3.报警后锁定。需要复位才能解除报警状态

2021.06.29 1033
1.对双地址的扩展地址也修改为支持广播命令写寄存器。
扩展地址不可写EE。
2.版本修改到V0110
2021.07.05 1706
1.有源输出和脉冲输出的通讯闪灯，修改为闪输出灯。
2.蜂鸣器感烟在报警和远程测试命令下，通讯不闪灯。因为蜂鸣器感烟是闪黄灯，故而存在和报警灯独立的问题
2021-07-07
1.IO模块统一修改灯。远程查询时，双地址的都闪上灯。单地址的IO模块也闪上等。
2.单输入模块只焊接上灯。所以，也要修改为上灯

2021-07-08
1.AV和蜂鸣器感烟的频率进行了微调。
2.感烟探测器的工厂命令D0的C1命令后 无法进入低功耗。修订后待测试。

2021-07-08 1718
1.感烟为提高报警速度。修订为>12认为就是拐点；<11请拐点信号。
2.18点平均值

2021-07-14 1948
1.发现如果在比较电平和供电电平处于0.9V之内，这个时候检测电源电压，会触发通讯中断。
最终导致 每次动态调整的时候，都增加触发了通讯中断，然后导致动态调整因中断打断不再进行。
2。增加了两条机制：
   1）上电后不再分段，分段容易产生固定的电平和电源靠近的情况。
   2）增加机制，如果连续产生16次（1sec）被中断打断，不能进行动态调整，则强制比较电平为低。

2021-07-15 1134
1.在上述基础上，调整为连续48次(3sec)。增加可靠性。
2.读取最终计数。

2021-07-16 1554
1.蜂鸣器感烟的查询闪灯，从闪黄灯，修改为闪红灯。
2.默认配置为查询不闪灯。
3.不论配置是否闪灯。蜂鸣器感烟上电闪烁一下。然后首次发生通讯时，闪烁3下。
4.修订完待测

2021-07-17 0935
1.经过测试。上述功能正常

2021-07-23 2017
1.发现重大BUG：
  在校准时，计算校准参数时，虽然过程中是进行的16位计算，但是最终值会赋值给8位数据。
  当减掉洁净和暗值，如果校准系数超过144左右，将会导致计算溢出。
  最终导致不能报警。
  典型现象是：点检烟枪，直接喷烟时，突然跳值到满量程，将不能报警。
2.修改方式是，增加中间计算变量，如果中间值16位大于255，限制到255.
  这样无论校准值大到多少，都不会出现计算溢出的现象。
3.成本版本升级至V13

2021-08-30 1030
1.在通讯帧中增加0xF9的报警查询命令。分为组内和组间。
2.版本升级至V14.
3.针对改动点待测试

2021-09-01 1127
1.验证了感烟和模块的0xF9的报警查询命令。
组内和组间均验证了。
2.版本升级至V14

2021-09-07 1421
1.感温探测器故障判断，增加短路和开路的互斥。
2.原因是存在从开路突然进入短路后，没有进入正常的过程，导致没有清开路，而同时报出开路和短路的情况

2021-09-17 1732
1.增加了屏蔽功能除了不再报出事件完，
  命令不响应
  状态不改变
  LED灯灭
2.待测。

2021-09-24 1635
1.本方案被抛弃。还是太复杂了。
2.重新从0907版本开始。

2021-10-18 1525
1.非使能的状态下，仅关闭LED灯。
2.尚未完整测试。

2021-10-28 1222
1.感烟和模块增加了 通讯的超时判断。
2.捕获滤波31~32TSYS
3.位超时后，增加错误类型。
4.尚未充分验证

2021-11-01 0959
1.长线1600+20只声光动作，通讯正常。但是D2.0控制器在超过1000m 报“回路端口故障”
2.10sec随机短路+50sec正常工作，目前1600次正常。
3.版本升级至V0115,生成对应的目标文件，供EPR使用



